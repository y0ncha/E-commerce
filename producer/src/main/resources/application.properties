# Application Configuration
spring.application.name=producer
server.port=8080

# Logging Configuration
logging.level.root=INFO
logging.level.mta.eda.producer=DEBUG

# Suppress Kafka AdminClient bootstrap spam
logging.level.org.apache.kafka.clients.admin.AdminMetadataManager=WARN
# Suppress other verbose Kafka client logs
logging.level.org.apache.kafka.clients=WARN
logging.level.org.apache.kafka.common.network=WARN
logging.level.org.springframework.kafka=WARN

# Kafka Bootstrap
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Kafka Admin startup behavior
spring.kafka.admin.fail-fast=false
spring.kafka.admin.properties.allow.auto.create.topics=false
spring.kafka.properties.request.timeout.ms=5000
spring.kafka.properties.default.api.timeout.ms=5000

# Key Serializer (orderId as the message key)
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer

# Value Serializer (JSON format)
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer

# Producer Acknowledgments (Durability)
spring.kafka.producer.acks=all

# Retry Configuration (Online Retry Strategy)
# Set to MAX_INT to ensure Kafka retries until delivery.timeout.ms is reached
spring.kafka.producer.retries=2147483647
spring.kafka.producer.properties.retry.backoff.ms=100

# Batch & Compression (Performance)
spring.kafka.producer.properties.batch.size=16384
spring.kafka.producer.properties.compression.type=snappy
spring.kafka.producer.properties.linger.ms=5

# Timeout Alignment (Synchronous Online Retry)
# request.timeout.ms: 3s per attempt (allows ~2-3 attempts within the 8s window)
spring.kafka.producer.properties.request.timeout.ms=3000
# delivery.timeout.ms: 8s total (Ensures Kafka client gives up before the 10s API timeout)
spring.kafka.producer.properties.delivery.timeout.ms=8000
# max.block.ms: Max time to wait for metadata (5s)
spring.kafka.producer.properties.max.block.ms=5000

# API Send Timeout (10s total limit for the service call)
producer.send.timeout.ms=10000

# Topic Configuration
kafka.topic.name=order-events
kafka.topic.partitions=3
kafka.topic.replication-factor=1

# Idempotence (Exactly Once Semantics)
spring.kafka.producer.properties.enable.idempotence=true

# Actuator health exposure
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true

# Disable default Kafka health indicator (we use our custom KafkaHealthService)
management.health.kafka.enabled=false

# Circuit Breaker Configuration (Resilience4j)
# Name: cartService
resilience4j.circuitbreaker.instances.cartService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.cartService.sliding-window-size=10
resilience4j.circuitbreaker.instances.cartService.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.cartService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.cartService.sliding-window-type=COUNT_BASED
