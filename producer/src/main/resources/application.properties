# Application Configuration
spring.application.name=producer
server.port=8080

# Logging Configuration
logging.level.root=INFO
logging.level.mta.eda.producer=DEBUG

# Suppress Kafka AdminClient bootstrap spam
logging.level.org.apache.kafka.clients.admin.AdminMetadataManager=WARN
# Suppress other verbose Kafka client logs
logging.level.org.apache.kafka.clients=WARN
logging.level.org.apache.kafka.common.network=WARN
logging.level.org.springframework.kafka=WARN

# Kafka Bootstrap
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Kafka Admin startup behavior (do not fail app if broker is down)
spring.kafka.admin.fail-fast=false
spring.kafka.admin.properties.allow.auto.create.topics=false
spring.kafka.properties.request.timeout.ms=5000
spring.kafka.properties.default.api.timeout.ms=5000

# Key Serializer (orderId as the message key)
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer

# Value Serializer (JSON format)
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer

# Producer Acknowledgments (Durability - Critical)
spring.kafka.producer.acks=all

# Retry Configuration (Resilience - Critical)
# Set to Integer.MAX_VALUE to retry indefinitely until delivery.timeout.ms is reached
spring.kafka.producer.retries=2147483647

# Exponential Backoff Strategy
spring.kafka.producer.properties.retry.backoff.ms=100

# Batch & Compression (Performance)
spring.kafka.producer.properties.batch.size=16384
spring.kafka.producer.properties.compression.type=snappy
spring.kafka.producer.properties.linger.ms=5

# Timeout (Connection Handling - Background Buffering)
# request.timeout.ms: Max time to wait for a single broker response
spring.kafka.producer.properties.request.timeout.ms=30000
# delivery.timeout.ms: Total time for send + retries (2 minutes)
spring.kafka.producer.properties.delivery.timeout.ms=120000
# max.block.ms: Max time to wait for metadata (5s)
spring.kafka.producer.properties.max.block.ms=5000

# API Send Timeout (Custom property used in KafkaProducerService)
# Must be significantly shorter than delivery.timeout.ms to allow fail-fast API response
producer.send.timeout.ms=10000

# Topic Configuration
kafka.topic.name=order-events
kafka.topic.partitions=3
kafka.topic.replication-factor=1

# Idempotence (Exactly Once Semantics - Critical)
spring.kafka.producer.properties.enable.idempotence=true

# Actuator health exposure
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true

# Circuit Breaker Configuration (Resilience4j)
# Name: kafkaProducer
resilience4j.circuitbreaker.instances.kafkaProducer.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.kafkaProducer.sliding-window-size=10
resilience4j.circuitbreaker.instances.kafkaProducer.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.kafkaProducer.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.kafkaProducer.sliding-window-type=COUNT_BASED
