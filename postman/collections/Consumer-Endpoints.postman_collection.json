{
  "info": {
    "_postman_id": "consumer-endpoints-col-2024",
    "name": "Consumer Endpoints - Exercise 2",
    "description": "Comprehensive tests for Order Consumer Service endpoints with validation scripts",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health & Status",
      "item": [
        {
          "name": "Root Endpoint",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test: Status code is 200",
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Test: Response structure",
                  "pm.test(\"Response has service metadata\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('service');",
                  "    pm.expect(jsonData).to.have.property('timestamp');",
                  "    pm.expect(jsonData).to.have.property('endpoints');",
                  "});",
                  "",
                  "// Test: Service name",
                  "pm.test(\"Service name is correct\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.service).to.include('Order Service');",
                  "    pm.expect(jsonData.service).to.include('Consumer');",
                  "});",
                  "",
                  "// Test: Endpoints are documented",
                  "pm.test(\"Endpoints are properly documented\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.endpoints).to.have.property('health');",
                  "    pm.expect(jsonData.endpoints).to.have.property('orders');",
                  "    pm.expect(jsonData.endpoints.orders).to.have.property('orderDetails');",
                  "    pm.expect(jsonData.endpoints.orders).to.have.property('getAllOrdersFromTopic');",
                  "});",
                  "",
                  "// Test: Health endpoints are GET",
                  "pm.test(\"Health endpoints use GET method\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.endpoints.health.live.method).to.eql('GET');",
                  "    pm.expect(jsonData.endpoints.health.ready.method).to.eql('GET');",
                  "});",
                  "",
                  "// Test: Order endpoints are GET (not POST)",
                  "pm.test(\"Order endpoints use GET method\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.endpoints.orders.orderDetails.method).to.eql('GET');",
                  "    pm.expect(jsonData.endpoints.orders.getAllOrdersFromTopic.method).to.eql('GET');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "id": "root-endpoint-consumer",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url_consumer}}/",
              "host": [
                "{{base_url_consumer}}"
              ],
              "path": [
                ""
              ]
            },
            "description": "Root endpoint providing API metadata and available endpoints"
          },
          "response": []
        },
        {
          "name": "Liveness Probe",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Service is UP\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('UP');",
                  "});",
                  "",
                  "pm.test(\"Service check is UP\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.checks.service.status).to.eql('UP');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "id": "liveness-probe",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url_consumer}}/health/live",
              "host": [
                "{{base_url_consumer}}"
              ],
              "path": [
                "health",
                "live"
              ]
            },
            "description": "Liveness probe - checks if service is running"
          },
          "response": []
        },
        {
          "name": "Readiness Probe",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 503\", () => {",
                  "    const status = pm.response.code;",
                  "    pm.expect([200, 503]).to.include(status);",
                  "});",
                  "",
                  "pm.test(\"Response has required fields\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('checks');",
                  "});",
                  "",
                  "pm.test(\"Service check exists\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.checks).to.have.property('service');",
                  "    pm.expect(jsonData.checks).to.have.property('kafka');",
                  "    pm.expect(jsonData.checks).to.have.property('local-state');",
                  "});",
                  "",
                  "pm.test(\"Kafka status is available\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    const kafkaStatus = jsonData.checks.kafka.status;",
                  "    pm.expect(['UP', 'DOWN']).to.include(kafkaStatus);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "id": "readiness-probe",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url_consumer}}/health/ready",
              "host": [
                "{{base_url_consumer}}"
              ],
              "path": [
                "health",
                "ready"
              ]
            },
            "description": "Readiness probe - checks if service is ready (Kafka connected)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Order Operations",
      "item": [
        {
          "name": "Get Order Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test: Status code is 200",
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Test: Response contains all required order fields",
                  "pm.test(\"Response has all order fields\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('orderId');",
                  "    pm.expect(jsonData).to.have.property('customerId');",
                  "    pm.expect(jsonData).to.have.property('orderDate');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('items');",
                  "    pm.expect(jsonData).to.have.property('totalAmount');",
                  "    pm.expect(jsonData).to.have.property('currency');",
                  "    pm.expect(jsonData).to.have.property('shippingCost');",
                  "});",
                  "",
                  "// Test: Order ID matches request",
                  "pm.test(\"Order ID matches request parameter\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    const requestedId = pm.request.url.query.toObject().orderId;",
                  "    pm.expect(jsonData.orderId).to.include(requestedId);",
                  "});",
                  "",
                  "// Test: Status is valid",
                  "pm.test(\"Order status is valid\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    const validStatuses = ['CREATED', 'CONFIRMED', 'DISPATCHED', 'DELIVERED'];",
                  "    pm.expect(validStatuses).to.include(jsonData.status);",
                  "});",
                  "",
                  "// Test: Shipping cost is numeric and non-negative",
                  "pm.test(\"Shipping cost is numeric and non-negative\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    const shippingCost = jsonData.shippingCost;",
                  "    pm.expect(shippingCost).to.be.a('number');",
                  "    pm.expect(shippingCost).to.be.at.least(0);",
                  "});",
                  "",
                  "// Test: Items array is not empty",
                  "pm.test(\"Order has items\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.items).to.be.an('array');",
                  "    pm.expect(jsonData.items.length).to.be.greaterThan(0);",
                  "});",
                  "",
                  "// Test: Total amount is positive",
                  "pm.test(\"Order has positive total amount\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.totalAmount).to.be.a('number');",
                  "    pm.expect(jsonData.totalAmount).to.be.greaterThan(0);",
                  "});",
                  "",
                  "// Test: Currency is USD",
                  "pm.test(\"Currency is USD\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.currency).to.equal('USD');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "id": "get-order-details",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url_consumer}}/order-details?orderId=001",
              "host": [
                "{{base_url_consumer}}"
              ],
              "path": [
                "order-details"
              ],
              "query": [
                {
                  "key": "orderId",
                  "value": "001",
                  "description": "Order ID to retrieve (without ORD- prefix)"
                }
              ]
            },
            "description": "Get order details by order ID using GET with query parameter"
          },
          "response": []
        },
        {
          "name": "Get All Orders From Topic",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test: Status code is 200",
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Test: Response contains required fields",
                  "pm.test(\"Response has required fields\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('topic');",
                  "    pm.expect(jsonData).to.have.property('orderCount');",
                  "    pm.expect(jsonData).to.have.property('orderIds');",
                  "    pm.expect(jsonData).to.have.property('timestamp');",
                  "});",
                  "",
                  "// Test: Topic name matches request",
                  "pm.test(\"Topic name matches request parameter\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    const requestTopic = pm.request.url.query.toObject().topicName;",
                  "    pm.expect(jsonData.topic).to.eql(requestTopic);",
                  "});",
                  "",
                  "// Test: Order count matches array length",
                  "pm.test(\"Order count matches orderIds array length\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.orderCount).to.eql(jsonData.orderIds.length);",
                  "});",
                  "",
                  "// Test: orderIds is an array",
                  "pm.test(\"orderIds is an array\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.orderIds).to.be.an('array');",
                  "});",
                  "",
                  "// Test: Timestamp is numeric",
                  "pm.test(\"Timestamp is numeric\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.timestamp).to.be.a('number');",
                  "    pm.expect(jsonData.timestamp).to.be.greaterThan(0);",
                  "});",
                  "",
                  "// Test: All order IDs match expected format",
                  "pm.test(\"All order IDs have ORD- prefix\", () => {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.orderCount > 0) {",
                  "        const allValid = jsonData.orderIds.every(id => id.startsWith('ORD-'));",
                  "        pm.expect(allValid).to.be.true;",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "id": "get-all-orders-from-topic",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url_consumer}}/getAllOrdersFromTopic?topicName=order-events",
              "host": [
                "{{base_url_consumer}}"
              ],
              "path": [
                "getAllOrdersFromTopic"
              ],
              "query": [
                {
                  "key": "topicName",
                  "value": "order-events",
                  "description": "Kafka topic name to query"
                }
              ]
            },
            "description": "Get all order IDs from Kafka topic using GET with query parameter"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Integration Tests",
      "item": [
        {
          "name": "Test Flow: Create Order → Check Topic → Get Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// This test is designed to be run as part of a sequence:",
                  "// 1. Create order on producer",
                  "// 2. Query topic on consumer",
                  "// 3. Get order details on consumer",
                  "",
                  "pm.test(\"Integration test: All endpoints accessible\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "id": "integration-flow",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url_consumer}}/health/ready",
              "host": [
                "{{base_url_consumer}}"
              ],
              "path": [
                "health",
                "ready"
              ]
            },
            "description": "Check if consumer is ready (Kafka connected) before running integration tests"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url_consumer",
      "value": "http://localhost:8082/order-service",
      "type": "string"
    }
  ]
}
