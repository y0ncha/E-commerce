spring.application.name=order-service
server.port=8082

# Kafka Configuration
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.consumer.group-id=order-service-group
spring.kafka.consumer.auto-offset-reset=earliest
# MANDATORY: Disable auto-commit to support manual offset management.
# This enables At-Least-Once delivery semantics by allowing the application
# to acknowledge offsets only after successful processing, preventing message loss.
spring.kafka.consumer.enable-auto-commit=false
# MANDATORY: Set listener acknowledgment mode to MANUAL_IMMEDIATE.
# This ensures offsets are committed immediately upon manual acknowledge() call,
# supporting strict message ordering guarantees for duplicate detection and sequencing.
spring.kafka.listener.ack-mode=manual_immediate

# Kafka Connection Timeouts (Lenient to allow standalone mode)
# These are intentionally generous to prevent failures when Kafka is unavailable
# Kafka connectivity is checked asynchronously by KafkaConnectivityService
spring.kafka.properties.connections.max.idle.ms=60000
# Session timeout: 30s (default) to allow graceful disconnect
spring.kafka.consumer.properties.session.timeout.ms=30000
# Heartbeat interval: 3s (default) for liveness detection
spring.kafka.consumer.properties.heartbeat.interval.ms=3000
# Metadata refresh: 5m (300s) - don't hammer broker when unavailable
spring.kafka.consumer.properties.metadata.max.age.ms=300000
# Request timeout: 30s (default) - give broker time to respond
spring.kafka.consumer.properties.request.timeout.ms=30000
# Reconnect backoff: 1-100ms to prevent overwhelming broker when down
spring.kafka.properties.reconnect.backoff.ms=1
spring.kafka.properties.reconnect.backoff.max.ms=100

# Kafka Admin (Prevent startup failure if Kafka is down during tests)
spring.kafka.admin.fail-fast=false

# Kafka Listeners: Do NOT auto-start at Spring Boot startup
# Instead, manually start them in KafkaConnectivityService when Kafka becomes available
# This allows the application to start even if Kafka is unavailable (standalone mode)
spring.kafka.listener.auto-startup=false

# CRITICAL: Prevent Kafka listener container initialization failure when broker unavailable
spring.kafka.listener.poll-timeout=3000

# Consumer Topic (configurable via environment variable KAFKA_TOPIC)
kafka.consumer.topic=${KAFKA_TOPIC:orders}

# Logging
logging.level.root=INFO
logging.level.mta.eda.consumer=DEBUG

# Send 404s for unknown endpoints through ControllerAdvice
spring.web.resources.add-mappings=false
